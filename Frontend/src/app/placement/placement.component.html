<div class="placement-container mr-3 ml-3">
  <div class="placement-header mt-3">
    <div>
      <span class="placement-title">Placements</span>
    </div>
    <div class="placement-buttons-container">
      <div style="display: flex; align-items: center" class="mr-2">
        <span class="mr-2" style="margin-left: 5%; width: 120px"
          >Score Tables:
        </span>
        <select
          [(ngModel)]="placementTable"
          (change)="buttonReArrange()"
          [disabled]="this.placementTables.length === 0">
          <option value="Select a table" disabled selected>
            Select a table
          </option>
          <option *ngFor="let table of this.placementTables" [ngValue]="table">
            {{ table.fileName }}
          </option>
        </select>
      </div>
      <button
        (click)="placeStudents()"
        mat-raised-button
        color="primary"
        class="mr-3"
        #placeStudentsButton>
        Perform Auto-Placement
      </button>
      <button
        (click)="downloadCurrentTable()"
        mat-raised-button
        color="accent"
        #downloadTableButton>
        Download Current Score Table
      </button>
    </div>
  </div>
  <div class="placement-content mt-4">
    <div style="width: 70%">
      <div class="table-header">
        <mat-form-field>
          <mat-icon matPrefix class="mr-3">search</mat-icon>
          <input
            type="search"
            matInput
            (keyup)="applyFilter($event.target.value)"
            placeholder="Search" />
        </mat-form-field>
      </div>

      <mat-tab-group (selectedIndexChange)="_setDataSource($event)">
        <mat-tab label="Placed Students">
          <div class="table-container mat-elevation-z8">
            <table
              #PlacementTable
              mat-table
              [dataSource]="dataSource"
              matSort
              #sort="matSort">
              <!-- Name Column -->
              <ng-container matColumnDef="name">
                <th
                  style="white-space: nowrap"
                  mat-header-cell
                  *matHeaderCellDef
                  mat-sort-header>
                  Student Name
                </th>
                <td mat-cell *matCellDef="let row">
                  <div class="name-column-cell">
                    <div>
                      <mat-icon svgIcon="user" style="scale: 1.3"></mat-icon>
                    </div>
                    <div class="name-dep-pair ml-3">
                      <span>{{ row.name }}</span>
                      <span class="gray-text mt-1">{{ row.department }}</span>
                    </div>
                  </div>
                </td>
              </ng-container>

              <!-- Preferences Column -->
              <ng-container matColumnDef="preferences">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  Host University
                </th>
                <td mat-cell *matCellDef="let row">
                  {{ row.hostUniversity }}
                </td>
              </ng-container>

              <!-- Score Column -->
              <ng-container matColumnDef="score">
                <th
                  mat-header-cell
                  class="scoreColumn"
                  *matHeaderCellDef
                  mat-sort-header>
                  Score
                </th>
                <td
                  mat-cell
                  class="scoreColumn"
                  *matCellDef="let row"
                  [style.color]="row.color">
                  {{ row.score }}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr
                mat-row
                *matRowDef="let row; columns: displayedColumns"
                (click)="selection.toggle(row)"
                [ngClass]="{
                  hovered: row.hovered,
                  highlighted: selection.isSelected(row)
                }"
                (mouseover)="row.hovered = true"
                (mouseout)="row.hovered = false"></tr>
            </table>

            <mat-paginator
              #paginator
              [pageSizeOptions]="[7]"
              [pageSize]="7"
              [showFirstLastButtons]="true"
              [hidePageSize]="true"></mat-paginator>
          </div>
        </mat-tab>
        <mat-tab label="Waiting List">
          <div class="table-container mat-elevation-z8">
            <table
              mat-table
              #WaitingTable
              [dataSource]="dataSourceWaiting"
              matSort
              #sortWaiting="matSort">
              <!-- Name Column -->
              <ng-container matColumnDef="name">
                <th
                  style="white-space: nowrap"
                  mat-header-cell
                  *matHeaderCellDef
                  mat-sort-header>
                  Student Name
                </th>
                <td mat-cell *matCellDef="let row">
                  <div class="name-column-cell" style="padding: 8px 12px 8px 0">
                    <div>
                      <mat-icon svgIcon="user" style="scale: 1.3"></mat-icon>
                    </div>
                    <div class="name-dep-pair ml-3">
                      <span>{{ row.name }}</span>
                      <span class="gray-text mt-1">{{ row.department }}</span>
                    </div>
                  </div>
                </td>
              </ng-container>

              <!-- Preferences Column -->
              <ng-container matColumnDef="preferences">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  Preferences
                </th>
                <td mat-cell *matCellDef="let row">
                  <div style="padding-right: 12px; line-height: 18px">
                    {{ row.preferences }}
                  </div>
                </td>
              </ng-container>

              <!-- Score Column -->
              <ng-container matColumnDef="score">
                <th
                  mat-header-cell
                  class="scoreColumn"
                  *matHeaderCellDef
                  mat-sort-header>
                  Score
                </th>
                <td
                  mat-cell
                  class="scoreColumn"
                  *matCellDef="let row"
                  [style.color]="row.color">
                  {{ row.score }}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr
                mat-row
                *matRowDef="let row; columns: displayedColumns"
                (click)="selection.toggle(row)"
                [ngClass]="{
                  hovered: row.hovered,
                  highlighted: selection.isSelected(row)
                }"
                (mouseover)="row.hovered = true"
                (mouseout)="row.hovered = false"></tr>
            </table>

            <mat-paginator
              #paginatorWaiting
              [pageSizeOptions]="[7]"
              [pageSize]="7"
              [showFirstLastButtons]="true"
              [hidePageSize]="true"></mat-paginator>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
    <div class="preview-container">
      <div class="preview-header">
        <img src="../assets/icons/big-user.svg" class="mt-3" />
        <span class="mt-2 preview-name">{{ selection.selected[0].name }}</span>
        <div class="preview-icons">
          <a href="mailto:{{ selection.selected[0].email }}">
            <button
              mat-icon-button
              *ngIf="
                selection.selected[0].email !== null &&
                selection.selected[0].email !== ''
              ">
              <mat-icon svgIcon="mail"></mat-icon>
            </button>
          </a>
          <!-- <button mat-icon-button>
            <mat-icon svgIcon="messages"></mat-icon>
          </button> -->
        </div>
      </div>
      <mat-divider></mat-divider>
      <div class="preview-info mt-3">
        <span class="info-title">Info</span>
        <div class="mt-2 preview-pair">
          <span class="gray-text">CGPA</span>
          <span>{{ selection.selected[0].cpga }}</span>
        </div>
        <mat-divider></mat-divider>
        <div class="mt-2 preview-pair">
          <span class="gray-text">Bilkent ID Number</span>
          <span>{{ selection.selected[0].id }}</span>
        </div>
        <mat-divider></mat-divider>
        <div class="mt-2 preview-pair">
          <span class="gray-text">Department</span>
          <span style="text-align: right">{{
            selection.selected[0].departmentFull
          }}</span>
        </div>
        <mat-divider></mat-divider>
        <div class="mt-2 preview-pair">
          <span class="gray-text">Preferred Term</span>
          <span style="text-align: right">{{
            selection.selected[0].prefTerm
          }}</span>
        </div>
        <mat-divider></mat-divider>
        <div class="mt-2 preview-pair">
          <span
            class="green-text"
            *ngIf="
              selection.selected[0].email !== null &&
              selection.selected[0].email !== ''
            "
            >Registered</span
          >
        </div>
      </div>
    </div>
  </div>
</div>
